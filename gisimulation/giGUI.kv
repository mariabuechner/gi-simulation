#:kivy 1.10.0
#:import np numpy
#:import ntpath ntpath
#:import parser_def simulation.parser_def
#:import test kivy_test

#:set parser_info parser_def.get_arguments_info(parser_def.input_parser())
#:set num_input_size 0.3
#:set line_height 40

# All labels
<Label>:
    size_hint_y: None
    height: line_height
    canvas.before:
        Color:
            rgba: np.divide([88, 88, 88, 50],[255., 255., 255., 100.])
        Rectangle:
            pos: self.pos
            size: self.size

# All text inputs
<TextInput>:
    size_hint_y: None
    height: line_height
    size_hint_x: num_input_size
    multiline: False

# All checkboxes
<CheckBox>:
    size_hint: (None, None)
    height: line_height
    width: line_height
    canvas.before:
        Color:
            rgba: np.divide([88, 88, 88, 50],[255., 255., 255., 100.])
        Rectangle:
            pos: self.pos
            size: self.size


# All BoxLayouts
<BoxLayout>:
    spacing: 1
    padding: 1



# Set rules for custom classes

<SpectrumDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            path: "./data/spectra/"
            id: spectrum_filechooser

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(spectrum_filechooser.path, spectrum_filechooser.selection)

<ScrollableLabel>:
    Label:
        size_hint_y: None
        height: self.texture_size[1]
        text_size: self.width, None
        text: root.text

# gi GUI
<giGUI>:
    # Splitter to seperate general input area (left) and Tabs for results
    # and specific input (right)
    Splitter:
        sizable_from: 'right'
        max_size: root.width*0.9
        min_size: root.width*0.02



        # Right side of splitter
        # Content of 'general input window'
        BoxLayout:
            orientation: 'vertical'
            # Name of window
            Label:
                text: 'General parameters'

            GridLayout:
                cols: 2
                # General input
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: 'General Input'
                    BoxLayout:
                        orientation: 'vertical'
                        BoxLayout:
                            LabelHelp:
                                text: 'Design Energy [keV]'
                                help_message: parser_info['design_energy'][1]
                            FloatInput:
                                id: design_energy
                        BoxLayout:
                            LabelHelp:
                                size_hint_x: 0.4
                                text: 'Choose spectrum file'
                                help_message: "Location of spectrum file (.csv).\nFile format:\nenergy,photons\ne1,p1\ne2,p2\n.,.\n.,.\n.,."
                            Button:
                                size_hint_x: 0.1
                                text: 'Load'
                                on_press: root.show_spectrum_load()
                            Button:
                                size_hint_x: 0.15
                                text: 'Remove'
                                on_press: root.spectrum_file_path = ''
                            TextInput:
                                text: ntpath.basename(root.spectrum_file_path)
                                id: spectrum_file
                        BoxLayout:
                            LabelHelp:
                                text: 'Spectrum range [keV]'
                                help_message: parser_info['spectrum_range'][1]
                            CheckBox:
                                id: spectrum_range_set
                        BoxLayout:
                            BoxLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: 'Min'
                                FloatInput:
                                    id: spectrum_range_min
                                    size_hint_x: 1
                                    disabled: not spectrum_range_set.active
                            BoxLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: 'Max'
                                FloatInput:
                                    id: spectrum_range_max
                                    size_hint_x: 1
                                    disabled: not spectrum_range_set.active
                        BoxLayout:
                            LabelHelp:
                                text: 'Spectrum step size [keV]'
                                help_message:parser_info['spectrum_step'][1]
                            FloatInput:
                                id: spectrum_step
                                text: '1.0'
                                disabled: not spectrum_range_set.active or root.spectrum_file_loaded


                # GI input
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: 'GI Input'
                    BoxLayout:
                        orientation: 'vertical'
                        BoxLayout:
                            LabelHelp:
                                text: 'Geometry'
                                help_message: parser_info['geometry'][1]
                            Spinner:
                                id: geometry
                                text: 'sym'
                                values: ['sym', 'conv', 'inv', 'free']

                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: '3. block'
                    BoxLayout:
                        orientation: 'vertical'
                        Button:
                        Button:
                        Button:





    # Left side of splitter
    TabbedPanel:
        do_default_tab: False

        # Geometry
        TabbedPanelItem:
            text: 'Geometry'
            Label:
                text: '1. tab content area'

        # Visibility
        TabbedPanelItem:
            text: 'Visibility'
            Label:
                text: '2. tab content area'

        # CT
        TabbedPanelItem:
            text: 'CT'
            BoxLayout:
                Label:
                    text: 'bla'
                Button:
                    text: 'Raise error and display'
                    on_press: root.check_general_input()